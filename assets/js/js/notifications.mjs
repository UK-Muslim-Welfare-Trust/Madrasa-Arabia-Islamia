import{db as s,initializeMessaging as t}from"./firebase-init.mjs";import{doc as i,setDoc as o,deleteDoc as r,serverTimestamp as e}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";import{getToken as n}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging.js";import{getFunctions as c,httpsCallable as a}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-functions.js";export async function subscribeToTopic(r,f){const{messaging:u,messagingSupported:b}=await t();if(!b)return alert("Push notifications are not supported on this device."),!1;try{const t=await n(u,{vapidKey:"BCiOgp50gotHnfdiLjtx86mJZ-hGV94JWVuLjsiPsBd-CFAMpg8REdBZs6zb0Ofr5Lpo7Ezu50yAfEhgmcqIcMY"});if(t){const n=c(),f=a(n,"manageSubscription");await f({token:t,topic:r,action:"subscribe"});const u=i(s,"fcmTokens",t);return await o(u,{lastUsed:e()}),console.log(`Subscribed to ${r} and token tracked.`),!0}return!1}catch(s){return console.error(`Error subscribing to ${r}:`,s),!1}}export async function unsubscribeFromTopic(o,e){const{messaging:f}=await t(),u=await n(f,{vapidKey:"BCiOgp50gotHnfdiLjtx86mJZ-hGV94JWVuLjsiPsBd-CFAMpg8REdBZs6zb0Ofr5Lpo7Ezu50yAfEhgmcqIcMY"});if(u)try{const t=c(),e=a(t,"manageSubscription");await e({token:u,topic:o,action:"unsubscribe"});const n=i(s,"fcmTokens",u);await r(n),console.log(`Unsubscribed from ${o} and token untracked.`)}catch(s){console.error(`Error unsubscribing from ${o}:`,s)}}