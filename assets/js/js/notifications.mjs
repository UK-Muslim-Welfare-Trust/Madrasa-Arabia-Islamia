import{db as t}from"./firebase-init.mjs";import{doc as i,onSnapshot as o}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";let e=[];export async function requestLocalNotificationPermission(){if(!("Notification"in window))return console.error("This browser does not support desktop notification."),alert("This browser does not support notifications."),!1;try{return"granted"===await Notification.requestPermission()?(console.log("Local notification permission granted."),!0):(console.warn("Local notification permission was not granted."),!1)}catch(t){return console.error("An error occurred while requesting notification permission:",t),!1}}export function cancelJamaatNotifications(){console.log("Cancelling all scheduled Jama'at notifications."),e.forEach((t=>clearTimeout(t))),e=[]}export function scheduleJamaatNotifications(){console.log("Setting up listener to schedule Jama'at notifications...");const n=i(t,"/artifacts/masjid-connect-app/public/data/prayerTimes/today");o(n,(t=>{if(cancelJamaatNotifications(),t.exists()){const i=t.data(),o=new Date;for(const t in i)if(Object.hasOwnProperty.call(i,t)){const n=i[t];if("string"!=typeof n||!n.includes(":"))continue;const[a,s]=n.split(":"),r=new Date;r.setHours(a,s,0,0);const c=new Date(r.getTime()-9e5);if(c>o){const i=c.getTime()-o.getTime(),n=setTimeout((()=>{"granted"===Notification.permission&&"true"===localStorage.getItem("jamaatNotificationsEnabled")&&new Notification(`${t} Jamaat Reminder`,{body:`Jamaat for ${t} is in 15 minutes.`,icon:"/fav192.png",tag:`jamaat-${t}`})}),i);e.push(n)}}}}))}