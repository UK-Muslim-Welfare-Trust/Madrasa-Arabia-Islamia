import{db as t,initializeMessaging as i}from"./firebase-init.mjs";import{doc as o,onSnapshot as e,setDoc as n}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";import{getToken as a}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging.js";let s=[];export async function requestLocalNotificationPermission(){if(!("Notification"in window))return console.error("This browser does not support local notifications."),!1;try{return"granted"===await Notification.requestPermission()}catch(t){return console.error("Error requesting local notification permission:",t),!1}}export function scheduleJamaatNotifications(){const i=o(t,"/artifacts/masjid-connect-app/public/data/prayerTimes/today");e(i,(t=>{if(cancelJamaatNotifications(),t.exists()){const i=t.data(),o=new Date;for(const t in i){const e=i[t];if("string"!=typeof e||!e.includes(":"))continue;const[n,a]=e.split(":"),r=new Date;r.setHours(n,a,0,0);const c=new Date(r.getTime()-9e5);if(c>o){const i=c.getTime()-o.getTime(),e=setTimeout((()=>{"granted"===Notification.permission&&"true"===localStorage.getItem("jamaatNotificationsEnabled")&&new Notification(`${t} Jamaat Reminder`,{body:`Jamaat for ${t} is in 15 minutes.`,icon:"/fav192.png",tag:`jamaat-${t}`})}),i);s.push(e)}}}}))}export function cancelJamaatNotifications(){s.forEach((t=>clearTimeout(t))),s=[]}export async function requestPushNotificationPermission(){const{messaging:e,messagingSupported:s}=await i();if(!s)return alert("Push notifications are not supported on this device or browser."),!1;try{const i="BCiOgp50gotHnfdiLjtx86mJZ-hGV94JWVuLjsiPsBd-CFAMpg8REdBZs6zb0Ofr5Lpo7Ezu50yAfEhgmcqIcMY",s=await a(e,{vapidKey:i});if(s){const i=o(t,"fcmTokens",s);return await n(i,{token:s,createdAt:new Date}),console.log("Push notification token saved to Firestore."),!0}return console.warn("Could not get push notification token."),!1}catch(t){return console.error("An error occurred while getting push notification token:",t),!1}}