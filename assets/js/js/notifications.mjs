import{db as i,initializeMessaging as s}from"./firebase-init.mjs";import{doc as o,setDoc as t,deleteDoc as r,serverTimestamp as e}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";import{getToken as n}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging.js";import{getFunctions as c,httpsCallable as a}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-functions.js";export async function subscribeToTopic(r,f){if("denied"===Notification.permission)return console.warn("Notification permission has been blocked."),!1;const{messaging:b,messagingSupported:m}=await s();if(!m)return alert("Push notifications are not supported on this device."),!1;try{const s=await n(b,{vapidKey:"BCiOgp50gotHnfdiLjtx86mJZ-hGV94JWVuLjsiPsBd-CFAMpg8REdBZs6zb0Ofr5Lpo7Ezu50yAfEhgmcqIcMY",serviceWorkerRegistration:f});if(s){const n=c(),f=a(n,"manageSubscription");await f({token:s,topic:r,action:"subscribe"});const b=o(i,"fcmTokens",s);return await t(b,{lastUsed:e()}),console.log(`Subscribed to ${r} and token tracked.`),!0}return!1}catch(i){return console.error(`Error subscribing to ${r}:`,i),!1}}export async function unsubscribeFromTopic(t,e){const{messaging:f}=await s(),b=await n(f,{vapidKey:"BCiOgp50gotHnfdiLjtx86mJZ-hGV94JWVuLjsiPsBd-CFAMpg8REdBZs6zb0Ofr5Lpo7Ezu50yAfEhgmcqIcMY",serviceWorkerRegistration:e});if(b)try{const s=c(),e=a(s,"manageSubscription");await e({token:b,topic:t,action:"unsubscribe"});const n=o(i,"fcmTokens",b);await r(n),console.log(`Unsubscribed from ${t} and token untracked.`)}catch(i){console.error(`Error unsubscribing from ${t}:`,i)}}