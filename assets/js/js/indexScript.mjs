import{db as t}from"./firebase-init.mjs";import{doc as e,onSnapshot as n,getDoc as a,collection as o,query as r,orderBy as s}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const i="masjid-connect-app";function c(t){if(!t||!t.includes(":"))return t||"--:--";const[e,n]=t.split(":");let a=parseInt(e,10);const o=a>=12?"PM":"AM";return a%=12,a=a||12,`${a}:${n} ${o}`}function d(){const t=document.getElementById("donate-card"),e=document.getElementById("announcements-card");t&&e&&requestAnimationFrame((()=>{e.style.height=`${t.offsetHeight}px`}))}document.addEventListener("DOMContentLoaded",(()=>{!async function(){const t=document.getElementById("dateTodayC"),e=document.getElementById("dateTodayI");t&&(t.textContent=(new Date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}));if(e)try{const t=new Date,n=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),r=await fetch(`https://api.aladhan.com/v1/gToH?date=${n}-${a}-${o}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const s=await r.json();e.textContent=200===s.code&&s.data.hijri?`${s.data.hijri.day} ${s.data.hijri.month.en} ${s.data.hijri.year}`:"Hijri date unavailable"}catch(t){console.error("Could not fetch Hijri date:",t),e.textContent="Could not load Hijri date"}}(),function(){const a=e(t,`/artifacts/${i}/public/data/prayerTimes/today`);n(a,(t=>{const e=t.exists()?t.data():{};document.getElementById("pt-fajr").textContent=c(e.Fajr)||"--:--",document.getElementById("pt-zuhr").textContent=c(e.Zuhr)||"--:--",document.getElementById("pt-asr").textContent=c(e.Asr)||"--:--",document.getElementById("pt-isha").textContent=c(e.Isha)||"--:--",document.getElementById("pt-jummah").textContent=c(e.Jumma)||"--:--"}),(t=>console.error("Error listening to prayer times:",t)))}(),async function(){const n=document.getElementById("pt-maghrib");if(!n)return;try{const o=new Date,r=`${String(o.getDate()).padStart(2,"0")}-${String(o.getMonth()+1).padStart(2,"0")}`,s=e(t,`/artifacts/${i}/public/data/prayerCalendar/${r}`),d=await a(s);n.textContent=d.exists()?c(d.data().Maghrib):"N/A"}catch(t){console.error("Error fetching Maghrib time:",t),n.textContent="Error"}}(),function(){const e=document.querySelector("#announcements-card .list-group");if(!e)return;const a=o(t,`/artifacts/${i}/public/data/announcements`),c=r(a,s("timestamp","desc"));n(c,(t=>{e.innerHTML="",t.empty?e.innerHTML='<p class="p-4 text-muted">No announcements at this time.</p>':t.forEach((t=>{const n=t.data(),a=n.timestamp?n.timestamp.toDate():new Date,o=`\n                    <a href="#" class="list-group-item list-group-item-action border-0 py-3 px-2 px-lg-3">\n                        <div class="d-flex w-100 justify-content-between">\n                            <h5 class="mb-1 fs-6 fw-semibold">${n.title||"No Title"}</h5>\n                            <small class="text-body-secondary flex-shrink-0 ms-2">${function(t){const e=Math.floor((new Date-t)/1e3);let n=e/31536e3;return n>1?`${Math.floor(n)} year${Math.floor(n)>1?"s":""} ago`:(n=e/2592e3,n>1?`${Math.floor(n)} month${Math.floor(n)>1?"s":""} ago`:(n=e/86400,n>1?`${Math.floor(n)} day${Math.floor(n)>1?"s":""} ago`:(n=e/3600,n>1?`${Math.floor(n)} hour${Math.floor(n)>1?"s":""} ago`:(n=e/60,n>1?`${Math.floor(n)} minute${Math.floor(n)>1?"s":""} ago`:`${Math.floor(e)} seconds ago`))))}(a)}</small>\n                        </div>\n                        <p class="mb-1 small">${n.message||""}</p>\n                    </a>`;e.insertAdjacentHTML("beforeend",o)})),d()}),(t=>{console.error("Error fetching announcements:",t),e.innerHTML='<p class="p-4 text-danger">Could not load announcements.</p>',d()}))}(),d(),window.addEventListener("resize",d),window.addEventListener("load",d)}));