import{doc as t,onSnapshot as e,getDoc as n,collection as o,query as a,orderBy as r}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const s="masjid-connect-app",i=document.querySelector("#announcements-card .list-group"),c=document.getElementById("dateTodayC"),d=document.getElementById("dateTodayI");function l(t){if(!t||!t.includes(":"))return t;const[e,n]=t.split(":");let o=parseInt(e,10);const a=o>=12?"PM":"AM";return o%=12,o=o||12,`${o}:${n} ${a}`}function m(){const t=document.getElementById("donate-card"),e=document.getElementById("announcements-card");t&&e&&(e.style.height=`${t.offsetHeight}px`)}function u(t){if(!i)return void console.error("Announcements list container not found.");const n=o(t,`/artifacts/${s}/public/data/announcements`),c=a(n,r("timestamp","desc"));e(c,(t=>{i.innerHTML="",t.empty?i.innerHTML='<p class="p-4 text-muted">No announcements at this time.</p>':t.forEach((t=>{const e=t.data(),n=e.timestamp?e.timestamp.toDate():new Date,o=`\n                    <a href="#" class="list-group-item list-group-item-action border-0 py-3 px-2 px-lg-3">\n                        <div class="d-flex w-100 justify-content-between">\n                            <h5 class="mb-1 fs-6 fw-semibold">${e.title||"No Title"}</h5>\n                            <small class="text-body-secondary flex-shrink-0 ms-2">${function(t){const e=Math.floor((new Date-t)/1e3);let n=e/31536e3;return n>1?Math.floor(n)+" "+(Math.floor(n)>1?"years":"year")+" ago":(n=e/2592e3,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"months":"month")+" ago":(n=e/86400,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"days":"day")+" ago":(n=e/3600,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"hours":"hour")+" ago":(n=e/60,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"minutes":"minute")+" ago":Math.floor(e)+" seconds ago"))))}(n)}</small>\n                        </div>\n                        <p class="mb-1 small">${e.message||""}</p>\n                    </a>\n                `;i.insertAdjacentHTML("beforeend",o)})),m()}),(t=>{console.error("Error fetching announcements:",t),i.innerHTML='<p class="p-4 text-danger">Could not load announcements.</p>',m()}))}document.addEventListener("DOMContentLoaded",(function(){!function(){if(!c)return;const t=new Date;c.textContent=t.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}(),async function(){if(d)try{const t=new Date,e=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),a=await fetch(`https://api.aladhan.com/v1/gToH?date=${e}-${n}-${o}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(200===r.code&&r.data.hijri){const t=r.data.hijri;d.textContent=`${t.day} ${t.month.en} ${t.year}`}else d.textContent="Hijri date unavailable"}catch(t){console.error("Could not fetch Hijri date:",t),d.textContent="Could not load Hijri date"}}();const o=setInterval((()=>{if(void 0!==window.firebaseDb){clearInterval(o),console.log("Firebase DB instance from auth.js found. Running page logic.");const a=window.firebaseDb;!function(n){const o=`/artifacts/${s}/public/data/prayerTimes/today`,a=t(n,o);e(a,(t=>{if(t.exists()){const e=t.data();document.getElementById("pt-fajr").textContent=l(e.Fajr||"--:--"),document.getElementById("pt-zuhr").textContent=l(e.Zuhr||"--:--"),document.getElementById("pt-asr").textContent=l(e.Asr||"--:--"),document.getElementById("pt-isha").textContent=l(e.Isha||"--:--"),document.getElementById("pt-jummah").textContent=l(e.Jumma||"--:--")}else console.warn("Prayer times document does not exist for today at path:",o),["fajr","zuhr","asr","isha","jummah"].forEach((t=>{document.getElementById(`pt-${t}`).textContent="N/A"}))}),(t=>{console.error("Error listening to prayer times:",t)}))}(a),async function(e){const o=new Date,a=`${String(o.getDate()).padStart(2,"0")}-${String(o.getMonth()+1).padStart(2,"0")}`,r=t(e,`/artifacts/${s}/public/data/prayerCalendar/${a}`);try{const t=await n(r),e=document.getElementById("pt-maghrib");if(t.exists()){const n=t.data();e.textContent=l(n.Maghrib)||"N/A"}else e.textContent="N/A",console.warn(`Prayer calendar document does not exist for today: ${a}`)}catch(t){console.error("Error fetching Maghrib time from calendar:",t),document.getElementById("p-maghrib").textContent="Error"}}(a),u(a),window.addEventListener("load",m),window.addEventListener("resize",m)}else console.log("Waiting for Firebase DB instance from auth.js...")}),100)}));