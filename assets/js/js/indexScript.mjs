import{db as t}from"./firebase-init.mjs";import{doc as e,onSnapshot as n,getDoc as o,collection as a,query as r,orderBy as s}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const i="masjid-connect-app",c=document.querySelector("#announcements-card .list-group"),d=document.getElementById("dateTodayC"),m=document.getElementById("dateTodayI");function l(t){if(!t||!t.includes(":"))return t;const[e,n]=t.split(":");let o=parseInt(e,10);const a=o>=12?"PM":"AM";return o%=12,o=o||12,`${o}:${n} ${a}`}function u(){const t=document.getElementById("donate-card"),e=document.getElementById("announcements-card");t&&e&&(e.style.height=`${t.offsetHeight}px`)}function h(t){if(!c)return void console.error("Announcements list container not found.");const e=a(t,`/artifacts/${i}/public/data/announcements`),o=r(e,s("timestamp","desc"));n(o,(t=>{c.innerHTML="",t.empty?c.innerHTML='<p class="p-4 text-muted">No announcements at this time.</p>':t.forEach((t=>{const e=t.data(),n=function(t){const e=Math.floor((new Date-t)/1e3);let n=e/31536e3;return n>1?Math.floor(n)+" "+(Math.floor(n)>1?"years":"year")+" ago":(n=e/2592e3,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"months":"month")+" ago":(n=e/86400,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"days":"day")+" ago":(n=e/3600,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"hours":"hour")+" ago":(n=e/60,n>1?Math.floor(n)+" "+(Math.floor(n)>1?"minutes":"minute")+" ago":Math.floor(e)+" seconds ago"))))}(e.timestamp?e.timestamp.toDate():new Date),o=`\n                    <a href="#" class="list-group-item list-group-item-action border-0 py-3 px-2 px-lg-3">\n                        <div class="d-flex w-100 justify-content-between">\n                            <h5 class="mb-1 fs-6 fw-semibold">${e.title||"No Title"}</h5>\n                            <small class="text-body-secondary flex-shrink-0 ms-2">${n}</small>\n                        </div>\n                        <p class="mb-1 small">${e.message||""}</p>\n                    </a>\n                `;c.insertAdjacentHTML("beforeend",o)})),u()}),(t=>{console.error("Error fetching announcements:",t),c.innerHTML='<p class="p-4 text-danger">Could not load announcements.</p>',u()}))}document.addEventListener("DOMContentLoaded",(function(){if(d){const t=new Date;d.textContent=t.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}!async function(){if(m)try{const t=new Date,e=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),a=await fetch(`https://api.aladhan.com/v1/gToH?date=${e}-${n}-${o}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();if(200===r.code&&r.data.hijri){const t=r.data.hijri;m.textContent=`${t.day} ${t.month.en} ${t.year}`}else m.textContent="Hijri date unavailable"}catch(t){console.error("Could not fetch Hijri date:",t),m.textContent="Could not load Hijri date"}}();const a=e(t,`/artifacts/${i}/public/data/prayerTimes/today`);n(a,(t=>{if(t.exists()){const e=t.data();document.getElementById("pt-fajr").textContent=l(e.Fajr||"--:--"),document.getElementById("pt-zuhr").textContent=l(e.Zuhr||"--:--"),document.getElementById("pt-asr").textContent=l(e.Asr||"--:--"),document.getElementById("pt-isha").textContent=l(e.Isha||"--:--"),document.getElementById("pt-jummah").textContent=l(e.Jumma||"--:--")}else console.warn("Prayer times document does not exist for today."),["fajr","zuhr","asr","isha","jummah"].forEach((t=>{document.getElementById(`pt-${t}`).textContent="N/A"}))}),(t=>console.error("Error listening to prayer times:",t))),async function(){const n=new Date,a=`${String(n.getDate()).padStart(2,"0")}-${String(n.getMonth()+1).padStart(2,"0")}`,r=e(t,`/artifacts/${i}/public/data/prayerCalendar/${a}`);try{const t=await o(r),e=document.getElementById("pt-maghrib");t.exists()?e.textContent=l(t.data().Maghrib)||"N/A":e.textContent="N/A"}catch(t){console.error("Error fetching Maghrib time:",t),document.getElementById("pt-maghrib").textContent="Error"}}(),h(t),window.addEventListener("load",u),window.addEventListener("resize",u)}));