import{doc as t,onSnapshot as e,setLogLevel as n,updateDoc as a}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const o="masjid-connect-app";let r,i,s,c,d,l,m=null,u=null;async function g(){if(!m||!window.firebaseDb)return void console.error("Cannot save: prayer name or DB instance is missing.");const e=`${c.value}:${d.value}`,n=m;l.disabled=!0,l.textContent="Saving...";try{const r=window.firebaseDb,i=`/artifacts/${o}/public/data/prayerTimes/today`,s=t(r,i);console.log(`Updating ${n} to ${e} at ${i}`),await a(s,{[n]:e}),console.log("Successfully updated time."),u.hide()}catch(t){console.error("Failed to save time to Firestore:",t),alert("Error: Could not save the time. Please try again.")}finally{l.disabled=!1,l.textContent="Save changes"}}document.addEventListener("DOMContentLoaded",(async function(){r=document.getElementById("dateTodayC2"),i=document.getElementById("dateTodayI2"),s=document.getElementById("prayerNameToEdit"),c=document.getElementById("hourSelect"),d=document.getElementById("minuteSelect"),l=document.getElementById("saveTimeButton"),function(){const t=new Date;r.textContent=t.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}(),await async function(){try{const t=new Date,e=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear(),o=await fetch(`https://api.aladhan.com/v1/gToH?date=${e}-${n}-${a}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();if(200===r.code&&r.data.hijri){const t=r.data.hijri;i.textContent=`${t.day} ${t.month.en} ${t.year}`}else i.textContent="Hijri date unavailable"}catch(t){console.error("Could not fetch Hijri date:",t),i.textContent="Could not load Hijri date"}}(),function(){for(let t=0;t<24;t++){const e=String(t).padStart(2,"0"),n=new Option(e,e);c.add(n)}["00","15","30","45"].forEach((t=>{const e=new Option(t,t);d.add(e)}))}();const n=document.getElementById("editTimeModal");u=new bootstrap.Modal(n),document.querySelectorAll(".editable-time").forEach((t=>{t.addEventListener("click",(t=>{!function(t,e){m=t;const n=t.charAt(0).toUpperCase()+t.slice(1);if(s.textContent=n,e&&e.includes(":")){const[t,n]=e.split(":");c.value=t;const a=parseInt(n,10);d.value=a<8?"00":a<23?"15":a<38?"30":"45"}u.show()}(t.currentTarget.dataset.prayer,t.currentTarget.querySelector("span").textContent)}))})),l.addEventListener("click",g);const a=setInterval((()=>{void 0!==window.firebaseDb?(clearInterval(a),console.log("Firebase DB instance found. Subscribing to prayer times."),function(n){const a=`/artifacts/${o}/public/data/prayerTimes/today`;console.log(`Listening for prayer times at: ${a}`);const r=t(n,a);e(r,(t=>{if(t.exists()){console.log("Received prayer times data:",t.data());const e=t.data();document.getElementById("p-fajr").textContent=e.Fajr||"00:00",document.getElementById("p-zuhr").textContent=e.Zuhr||"00:00",document.getElementById("p-asr").textContent=e.Asr||"00:00",document.getElementById("p-maghrib").textContent=e.Maghrib||"00:00",document.getElementById("p-isha").textContent=e.Isha||"00:00",document.getElementById("p-jummah").textContent=e.Jumma||"00:00"}else console.warn("Prayer times document does not exist for today at path:",a),["fajr","zuhr","asr","maghrib","isha","jummah"].forEach((t=>{document.getElementById(`pt-${t}`).textContent="N/A"}))}),(t=>{console.error("Error listening to prayer times:",t)}))}(window.firebaseDb)):console.log("Waiting for Firebase DB instance to become available...")}),100)}));