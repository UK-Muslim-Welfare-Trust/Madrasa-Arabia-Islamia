import{requestLocalNotificationPermission as e,scheduleJamaatNotifications as t,cancelJamaatNotifications as o,requestPushNotificationPermission as n}from"./notifications.mjs";let i=null;document.addEventListener("DOMContentLoaded",(()=>{if("serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>console.log("ServiceWorker registration successful."))).catch((e=>console.error("ServiceWorker registration failed: ",e)))})),(()=>{const o=window.matchMedia("(display-mode: standalone)").matches,i=localStorage.getItem("notificationSetupComplete");if(o&&!i){console.log("First launch after install detected. Showing notification prompt.");const o=document.getElementById("notification-prompt-modal"),i=document.getElementById("enable-notifications-btn"),a=document.getElementById("subscribeAnnouncementsModal"),s=document.getElementById("subscribeJamaatModal");if(o&&i&&a&&s){const l=new bootstrap.Modal(o);l.show(),i.addEventListener("click",(async()=>{a.checked&&await n()&&localStorage.setItem("announcementNotificationsEnabled","true"),s.checked&&await e()&&(localStorage.setItem("jamaatNotificationsEnabled","true"),t()),localStorage.setItem("notificationSetupComplete","true"),l.hide(),alert("Notification settings saved!")}))}}})(),window.matchMedia("(display-mode: standalone)").matches){const e=document.getElementById("install-button");e&&(e.style.display="none")}else{(()=>{const e=document.getElementById("install-button");e&&(e.style.display="none",window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),i=t,e.style.display="block",console.log("beforeinstallprompt event fired. Install button is now visible.")})),e.addEventListener("click",(async()=>{if(!i)return;i.prompt();const{outcome:t}=await i.userChoice;console.log(`User response to the install prompt: ${t}`),i=null,e.style.display="none"})))})();const e=document.getElementById("notification-controls");e&&(e.style.display="none")}}));