import{requestNotificationPermission as e,scheduleJamaatNotifications as t}from"./notifications.mjs";import{initializeMessaging as o}from"./firebase-init.mjs";let n=null;const s=()=>{if("undefined"==typeof jQuery)return void console.error("jQuery is not loaded. UI plugins will not work.");const e=jQuery;setTimeout((()=>{e("#spinner").removeClass("show")}),1),"undefined"!=typeof WOW&&(new WOW).init(),e(window).scroll((function(){e(this).scrollTop()>300?e(".sticky-top").addClass("shadow-sm").css("top","0px"):e(".sticky-top").removeClass("shadow-sm").css("top","-150px")})),e(window).scroll((function(){e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}))};document.addEventListener("DOMContentLoaded",(async()=>{console.log("DOM fully loaded. Initializing app scripts."),"serviceWorker"in navigator?window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>console.log("ServiceWorker registration successful.",e))).catch((e=>console.error("ServiceWorker registration failed: ",e)))})):console.warn("ServiceWorker is not supported in this browser.");const{messagingSupported:i}=await o();if(window.matchMedia("(display-mode: standalone)").matches){const o=document.getElementById("install-button");o&&(o.style.display="none"),(o=>{const n=document.getElementById("notification-controls"),s=document.getElementById("jamaat-notifications-toggle");n&&s&&(window.location.pathname.includes("prayerTimetable.html")&&o?(n.style.display="block","true"===localStorage.getItem("jamaatNotificationsEnabled")&&(s.checked=!0,"granted"===Notification.permission&&t()),s.addEventListener("change",(()=>{s.checked?(localStorage.setItem("jamaatNotificationsEnabled","true"),e().then((e=>{e?t():(s.checked=!1,localStorage.setItem("jamaatNotificationsEnabled","false"))}))):localStorage.setItem("jamaatNotificationsEnabled","false")}))):n.style.display="none")})(i)}else{const e=document.getElementById("notification-controls");e&&(e.style.display="none"),(()=>{const e=document.getElementById("install-button");e&&(e.style.display="none",window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),n=t,e.style.display="block"})),e.addEventListener("click",(async()=>{if(!n)return;n.prompt();const{outcome:t}=await n.userChoice;console.log(`User response to the install prompt: ${t}`),n=null,e.style.display="none"})))})()}s()}));