import{requestLocalNotificationPermission as e,scheduleJamaatNotifications as t,cancelJamaatNotifications as o,requestPushNotificationPermission as n}from"./notifications.mjs";let a=null;const i=()=>{if("undefined"==typeof jQuery)return console.error("jQuery is not loaded.");const e=jQuery;setTimeout((()=>{e("#spinner").removeClass("show")}),1),e(window).scroll((function(){e(this).scrollTop()>300?e(".sticky-top").addClass("shadow-sm").css("top","0px"):e(".sticky-top").removeClass("shadow-sm").css("top","-150px")})),e(window).scroll((function(){e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}))};document.addEventListener("DOMContentLoaded",(async()=>{let s=null;if("serviceWorker"in navigator)try{s=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{type:"module"}),console.log("ServiceWorker registration successful.",s)}catch(e){console.error("ServiceWorker registration failed: ",e)}if((o=>{const a=window.matchMedia("(display-mode: standalone)").matches,i=localStorage.getItem("notificationSetupComplete");if(a&&!i){const a=document.getElementById("notification-prompt-modal"),i=document.getElementById("enable-notifications-btn"),s=document.getElementById("subscribeAnnouncementsModal"),c=document.getElementById("subscribeJamaatModal");if(a&&i&&s&&c){const l=new bootstrap.Modal(a);l.show(),i.addEventListener("click",(async()=>{let a=!1,i=!1;s.checked&&(o?(a=await n(o),a&&localStorage.setItem("announcementNotificationsEnabled","true")):(console.error("Service worker not registered, cannot request push permission."),alert("Could not set up push notifications. Please try again later."))),c.checked&&(i=await e(),i&&(localStorage.setItem("jamaatNotificationsEnabled","true"),t())),s.checked&&a||c.checked&&i?(localStorage.setItem("notificationSetupComplete","true"),alert("Notification settings saved!")):(s.checked||c.checked)&&alert("Could not enable one or more notification types. Please grant permission when prompted."),l.hide()}))}}})(s),window.matchMedia("(display-mode: standalone)").matches){const a=document.getElementById("install-button");a&&(a.style.display="none"),(a=>{if(!window.location.pathname.includes("prayerTimetable.html"))return;const i=document.getElementById("notification-controls");i&&(i.style.display="block");const s=document.getElementById("jamaat-notifications-toggle");s&&("true"===localStorage.getItem("jamaatNotificationsEnabled")&&(s.checked=!0,"granted"===Notification.permission&&t()),s.addEventListener("change",(async()=>{s.checked?await e()?(localStorage.setItem("jamaatNotificationsEnabled","true"),t()):s.checked=!1:(localStorage.setItem("jamaatNotificationsEnabled","false"),o())})));const c=document.getElementById("announcement-notifications-toggle");c&&("true"===localStorage.getItem("announcementNotificationsEnabled")&&(c.checked=!0),c.addEventListener("change",(async()=>{c.checked?a?await n(a)?localStorage.setItem("announcementNotificationsEnabled","true"):c.checked=!1:(console.error("Service worker not registered, cannot toggle push notifications."),c.checked=!1):localStorage.setItem("announcementNotificationsEnabled","false")})))})(s)}else{(()=>{const e=document.getElementById("install-button");e&&(e.style.display="none",window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),a=t,e.style.display="block"})),e.addEventListener("click",(async()=>{a&&(a.prompt(),await a.userChoice,a=null,e.style.display="none")})))})();const e=document.getElementById("notification-controls");e&&(e.style.display="none")}i()}));