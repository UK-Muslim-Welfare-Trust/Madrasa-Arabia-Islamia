import{subscribeToTopic as e,unsubscribeFromTopic as t,fetchAndScheduleJamaatReminders as n}from"./notifications.mjs";import{app as a}from"./firebase-init.mjs";let o=null,i=null;function s(){const e=document.getElementById("install-button");e&&(e.style.display="none",/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(e.style.display="block",e.addEventListener("click",(()=>{alert('To install, tap the Share button, then scroll down and tap "Add to Home Screen".')}))):(window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),o=t,e.style.display="block"})),e.addEventListener("click",(async()=>{o&&(o.prompt(),o=null,e.style.display="none")}))))}const l=()=>{if("undefined"==typeof jQuery)return;const e=jQuery;e("#spinner").removeClass("show"),e(window).scroll((function(){e(this).scrollTop()>300?e(".sticky-top").addClass("shadow-sm").css("top","0px"):e(".sticky-top").removeClass("shadow-sm").css("top","-150px"),e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((()=>(e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1)))};document.addEventListener("DOMContentLoaded",(async()=>{if("serviceWorker"in navigator)try{i=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{type:"module"}),console.log("ServiceWorker registration successful.")}catch(e){console.error("ServiceWorker registration failed:",e)}if(window.matchMedia("(display-mode: standalone)").matches){const a=document.getElementById("install-button");a&&(a.style.display="none");const o=document.getElementById("notification-controls");o&&(o.style.display="block"),function(){if(window.matchMedia("(display-mode: standalone)").matches&&!localStorage.getItem("notificationSetupComplete")){const t=document.getElementById("notification-prompt-modal"),n=document.getElementById("enable-notifications-btn"),a=document.getElementById("subscribeAnnouncementsModal"),o=document.getElementById("subscribeJamaatModal"),s=document.getElementById("notification-modal-spinner");if(!(t&&n&&a&&o&&s))return;const l=new bootstrap.Modal(t);l.show(),n.addEventListener("click",(async()=>{s.classList.remove("d-none"),n.disabled=!0;try{let t=!1;a.checked&&await e("announcements",i)&&(localStorage.setItem("announcementNotificationsEnabled","true"),t=!0),o.checked&&await e("jamaat",i)&&(localStorage.setItem("jamaatNotificationsEnabled","true"),t=!0),t?(localStorage.setItem("notificationSetupComplete","true"),alert("Notification settings saved!")):(a.checked||o.checked)&&alert("Could not enable notifications. Please grant permission when prompted."),l.hide()}finally{s.classList.add("d-none"),n.disabled=!1}}))}}(),function(){const n=document.getElementById("jamaat-notifications-toggle"),a=document.getElementById("jamaat-spinner");n&&(n.checked="true"===localStorage.getItem("jamaatNotificationsEnabled"),n.addEventListener("change",(async n=>{n.target.disabled=!0,a&&a.classList.remove("d-none");try{if(n.target.checked){const t=await e("jamaat",i);t||(n.target.checked=!1),localStorage.setItem("jamaatNotificationsEnabled",String(t))}else await t("jamaat",i),localStorage.setItem("jamaatNotificationsEnabled","false")}finally{n.target.disabled=!1,a&&a.classList.add("d-none")}})));const o=document.getElementById("announcement-toggle-container"),s=document.getElementById("announcement-notifications-toggle-main"),l=document.getElementById("announcement-spinner");o&&s&&window.matchMedia("(display-mode: standalone)").matches&&(o.style.display="block",s.checked="true"===localStorage.getItem("announcementNotificationsEnabled"),s.addEventListener("change",(async n=>{n.target.disabled=!0,l&&l.classList.remove("d-none");try{if(n.target.checked){const t=await e("announcements",i);t||(n.target.checked=!1),localStorage.setItem("announcementNotificationsEnabled",String(t))}else await t("announcements",i),localStorage.setItem("announcementNotificationsEnabled","false")}finally{n.target.disabled=!1,l&&l.classList.add("d-none")}})))}(),"true"===localStorage.getItem("jamaatNotificationsEnabled")&&i&&n()}else{s();const e=document.getElementById("notification-controls");e&&(e.style.display="none")}l()}));
