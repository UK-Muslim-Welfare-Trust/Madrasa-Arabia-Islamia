import{requestNotificationPermission as e,scheduleJamaatNotifications as t,cancelJamaatNotifications as o}from"./notifications.mjs";import{initializeMessaging as n}from"./firebase-init.mjs";let s=null;const i=()=>{if("undefined"==typeof jQuery)return void console.error("jQuery is not loaded. UI plugins will not work.");const e=jQuery;setTimeout((()=>{e("#spinner").removeClass("show")}),1),"undefined"!=typeof WOW&&(new WOW).init(),e(window).scroll((function(){e(this).scrollTop()>300?e(".sticky-top").addClass("shadow-sm").css("top","0px"):e(".sticky-top").removeClass("shadow-sm").css("top","-150px")})),e(window).scroll((function(){e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}))};document.addEventListener("DOMContentLoaded",(async()=>{console.log("DOM fully loaded. Initializing app scripts."),"serviceWorker"in navigator?window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>console.log("ServiceWorker registration successful.",e))).catch((e=>console.error("ServiceWorker registration failed: ",e)))})):console.warn("ServiceWorker is not supported in this browser.");const{messagingSupported:a}=await n();if(window.matchMedia("(display-mode: standalone)").matches){const n=document.getElementById("install-button");n&&(n.style.display="none"),(n=>{const s=document.getElementById("notification-controls"),i=document.getElementById("jamaat-notifications-toggle");s&&i&&(window.location.pathname.includes("prayerTimetable.html")&&n?(s.style.display="block","true"===localStorage.getItem("jamaatNotificationsEnabled")&&(i.checked=!0,"granted"===Notification.permission&&t()),i.addEventListener("change",(()=>{i.checked?(localStorage.setItem("jamaatNotificationsEnabled","true"),e().then((e=>{e?t():(i.checked=!1,localStorage.setItem("jamaatNotificationsEnabled","false"),o())}))):localStorage.setItem("jamaatNotificationsEnabled","false")}))):s.style.display="none")})(a)}else{const e=document.getElementById("notification-controls");e&&(e.style.display="none"),(()=>{const e=document.getElementById("install-button");e&&(e.style.display="none",window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),s=t,e.style.display="block"})),e.addEventListener("click",(async()=>{if(!s)return;s.prompt();const{outcome:t}=await s.userChoice;console.log(`User response to the install prompt: ${t}`),s=null,e.style.display="none"})))})()}i()}));