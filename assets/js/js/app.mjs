import{requestLocalNotificationPermission as e,scheduleJamaatNotifications as t,cancelJamaatNotifications as o,requestPushNotificationPermission as n}from"./notifications.mjs";let a=null;const i=()=>{if("undefined"==typeof jQuery)return console.error("jQuery is not loaded.");const e=jQuery;setTimeout((()=>{e("#spinner").removeClass("show")}),1),e(window).scroll((function(){e(this).scrollTop()>300?e(".sticky-top").addClass("shadow-sm").css("top","0px"):e(".sticky-top").removeClass("shadow-sm").css("top","-150px")})),e(window).scroll((function(){e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}))};document.addEventListener("DOMContentLoaded",(()=>{if("serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>console.log("ServiceWorker registration successful."))).catch((e=>console.error("ServiceWorker registration failed: ",e)))})),(()=>{const o=window.matchMedia("(display-mode: standalone)").matches,a=localStorage.getItem("notificationSetupComplete");if(o&&!a){const o=document.getElementById("notification-prompt-modal"),a=document.getElementById("enable-notifications-btn"),i=document.getElementById("subscribeAnnouncementsModal"),c=document.getElementById("subscribeJamaatModal");if(o&&a&&i&&c){const s=new bootstrap.Modal(o);s.show(),a.addEventListener("click",(async()=>{i.checked&&await n()&&localStorage.setItem("announcementNotificationsEnabled","true"),c.checked&&await e()&&(localStorage.setItem("jamaatNotificationsEnabled","true"),t()),localStorage.setItem("notificationSetupComplete","true"),s.hide(),alert("Notification settings saved!")}))}}})(),window.matchMedia("(display-mode: standalone)").matches){const a=document.getElementById("install-button");a&&(a.style.display="none"),(()=>{if(!window.location.pathname.includes("prayerTimetable.html"))return;const a=document.getElementById("notification-controls");a&&(a.style.display="block");const i=document.getElementById("jamaat-notifications-toggle");i&&("true"===localStorage.getItem("jamaatNotificationsEnabled")&&(i.checked=!0,"granted"===Notification.permission&&t()),i.addEventListener("change",(async()=>{i.checked?await e()?(localStorage.setItem("jamaatNotificationsEnabled","true"),t()):i.checked=!1:(localStorage.setItem("jamaatNotificationsEnabled","false"),o())})));const c=document.getElementById("announcement-notifications-toggle");c&&("true"===localStorage.getItem("announcementNotificationsEnabled")&&(c.checked=!0),c.addEventListener("change",(async()=>{c.checked?await n()?localStorage.setItem("announcementNotificationsEnabled","true"):c.checked=!1:localStorage.setItem("announcementNotificationsEnabled","false")})))})()}else{(()=>{const e=document.getElementById("install-button");e&&(e.style.display="none",window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),a=t,e.style.display="block"})),e.addEventListener("click",(async()=>{a&&(a.prompt(),await a.userChoice,a=null,e.style.display="none")})))})();const e=document.getElementById("notification-controls");e&&(e.style.display="none")}i()}));