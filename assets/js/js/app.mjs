import{requestNotificationPermission as o,scheduleJamaatNotifications as e}from"./notifications.mjs";import{messagingSupported as t}from"./firebase-init.mjs";let n=null;const s=()=>{if("undefined"==typeof jQuery)return void console.error("jQuery is not loaded. UI plugins will not work.");const o=jQuery;setTimeout((()=>{const e=o("#spinner");e.length&&e.removeClass("show")}),1),"undefined"!=typeof WOW&&(new WOW).init(),o(window).scroll((function(){const e=o(".sticky-top");o(this).scrollTop()>300?e.addClass("shadow-sm").css("top","0px"):e.removeClass("shadow-sm").css("top","-150px")})),o(window).scroll((function(){o(this).scrollTop()>100?o(".back-to-top").fadeIn("slow"):o(".back-to-top").fadeOut("slow")})),o(".back-to-top").click((function(){return o("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}))};document.addEventListener("DOMContentLoaded",(()=>{if(console.log("DOM fully loaded. Initializing app scripts."),"serviceWorker"in navigator?window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((o=>console.log("ServiceWorker registration successful.",o))).catch((o=>console.error("ServiceWorker registration failed: ",o)))})):console.warn("ServiceWorker is not supported in this browser."),window.matchMedia("(display-mode: standalone)").matches){console.log("App is running in standalone mode.");const n=document.getElementById("install-button");n&&(n.style.display="none"),(()=>{const n=document.getElementById("notification-controls"),s=document.getElementById("jamaat-notifications-toggle");n&&s?window.location.pathname.includes("prayerTimetable.html")&&t?(n.style.display="block","true"===localStorage.getItem("jamaatNotificationsEnabled")&&(s.checked=!0,"granted"===Notification.permission&&e()),s.addEventListener("change",(()=>{s.checked?(console.log("Notification toggle enabled."),localStorage.setItem("jamaatNotificationsEnabled","true"),o().then((o=>{o?e():(console.warn("Permission for notifications was not granted."),s.checked=!1,localStorage.setItem("jamaatNotificationsEnabled","false"))}))):(console.log("Notification toggle disabled."),localStorage.setItem("jamaatNotificationsEnabled","false"))}))):n.style.display="none":console.log("Notification controls not found on this page.")})()}else{console.log("App is running in browser mode.");const o=document.getElementById("notification-controls");o&&(o.style.display="none"),(()=>{const o=document.getElementById("install-button");o?(o.style.display="none",window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),n=e,o.style.display="block",console.log("beforeinstallprompt event fired. Install button is now visible.")})),o.addEventListener("click",(async()=>{if(!n)return void console.error("Install prompt was not deferred.");n.prompt();const{outcome:e}=await n.userChoice;console.log(`User response to the install prompt: ${e}`),n=null,o.style.display="none"}))):console.log("Install button not found on this page.")})()}s()}));