import{db as e}from"./firebase-init.mjs";import{doc as t,onSnapshot as n,updateDoc as o,collection as a,addDoc as m,serverTimestamp as d}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const s="artifacts/masjid-connect-app/public/data";let c,l,r;const i=e=>{if(!e||!e.includes(":"))return e||"--:--";const[t,n]=e.split(":");let o=parseInt(t,10);const a=o>=12?"PM":"AM";return o=o%12||12,`${o}:${n} ${a}`},u=e=>{r=e.currentTarget.dataset.prayer;const t=e.currentTarget.querySelector("span").textContent;if(document.getElementById("prayerNameToEdit").textContent=r.charAt(0).toUpperCase()+r.slice(1),t?.includes(":")){const[e,n]=t.split(":");document.getElementById("hourSelect").value=e.padStart(2,"0"),document.getElementById("minuteSelect").value=n.padStart(2,"0")}c&&c.show()},p=async()=>{const n=`${document.getElementById("hourSelect").value}:${document.getElementById("minuteSelect").value}`,l=document.getElementById("saveTimeButton");if(r){l.disabled=!0,l.textContent="Saving...";try{await o(t(e,`${s}/prayerTimes/today`),{[r]:n}),await m(a(e,`${s}/announcements`),{title:"Jama'ah Time Change",message:`The Jama'ah time for ${r} has been updated to ${i(n)}.`,timestamp:d()}),c&&c.hide()}catch(e){console.error("Failed to save time:",e),alert("Error: Could not save the time.")}finally{l.disabled=!1,l.textContent="Save changes"}}},y=async()=>{const t=document.getElementById("announcementTitle"),n=document.getElementById("announcementMessage"),o=document.getElementById("postAnnouncementBtn"),c=t.value.trim(),r=n.value.trim();if(c&&r){o.disabled=!0,o.textContent="Posting...",console.log("Attempting to post a new announcement...");try{const i=a(e,`${s}/announcements`);await m(i,{title:c,message:r,timestamp:d()}),console.log("Announcement posted successfully."),l&&l.hide(),t.value="",n.value=""}catch(e){console.error("Failed to post announcement:",e),alert("Error: Could not post the announcement. Check the console for details.")}finally{o.disabled=!1,o.textContent="Post Announcement"}}else alert("Please fill out both the title and the message.")};document.addEventListener("DOMContentLoaded",(()=>{const o=document.getElementById("editTimeModal");o&&(c=new bootstrap.Modal(o));const a=document.getElementById("announcementModal");a&&(l=new bootstrap.Modal(a)),document.getElementById("saveTimeButton")?.addEventListener("click",p),document.getElementById("postAnnouncementBtn")?.addEventListener("click",y),document.querySelectorAll(".editable-time").forEach((e=>e.addEventListener("click",u))),(()=>{const e=document.getElementById("hourSelect"),t=document.getElementById("minuteSelect");if(e&&t){for(let t=0;t<24;t++){const n=String(t).padStart(2,"0");e.add(new Option(n,n))}["00","05","10","15","20","25","30","35","40","45","50","55"].forEach((e=>{t.add(new Option(e,e))}))}})(),(async()=>{})(),(()=>{const o=t(e,`${s}/prayerTimes/today`);n(o,(e=>{const t=e.exists()?e.data():{};console.log("Admin panel received prayer time update:",t),document.getElementById("p-fajr").textContent=t.Fajr||"00:00",document.getElementById("p-zuhr").textContent=t.Zuhr||"00:00",document.getElementById("p-asr").textContent=t.Asr||"00:00",document.getElementById("p-isha").textContent=t.Isha||"00:00",document.getElementById("p-jummah").textContent=t.Jumma||"00:00",document.getElementById("p-jummah-2").textContent=t.Jumma2||"00:00"}),(e=>console.error("Error listening to prayer times on admin page:",e)))})(),(async()=>{})()}));