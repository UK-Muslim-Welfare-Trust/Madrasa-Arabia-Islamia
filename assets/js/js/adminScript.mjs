import{db as e}from"./firebase-init.mjs";import{doc as t,onSnapshot as n,updateDoc as o,collection as a,addDoc as s,serverTimestamp as l,getDoc as c}from"https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";const d="artifacts/masjid-connect-app/public/data";let m=null,r=null,i=null;const u=e=>{if(!e||!e.includes(":"))return e||"--:--";const[t,n]=e.split(":");let o=parseInt(t,10);const a=o>=12?"PM":"AM";return o=o%12||12,`${o}:${n} ${a}`},p=e=>{i=e.currentTarget.dataset.prayer;const t=e.currentTarget.querySelector("span").textContent,n=document.getElementById("prayerNameToEdit"),o=document.getElementById("hourSelect"),a=document.getElementById("minuteSelect");if(n&&o&&a){if(n.textContent=i.charAt(0).toUpperCase()+i.slice(1),t?.includes(":")){const[e,n]=t.split(":");o.value=e.padStart(2,"0"),a.value=n.padStart(2,"0")}m&&m.show()}else console.error("Modal elements for editing time are missing.")},g=async()=>{const n=`${document.getElementById("hourSelect").value}:${document.getElementById("minuteSelect").value}`,c=document.getElementById("saveTimeButton");if(i){c.disabled=!0,c.textContent="Saving...",console.log(`Attempting to save time for ${i}: ${n}`);try{const r=t(e,`${d}/prayerTimes/today`);await o(r,{[i]:n}),console.log("Prayer time updated successfully.");const p=a(e,`${d}/announcements`);await s(p,{title:"Jama'ah Time Change",message:`The Jama'ah time for ${i} has been updated to ${u(n)}.`,timestamp:l()}),console.log("Announcement for time change posted successfully."),m&&m.hide()}catch(e){console.error("Failed to save time:",e),alert("Error: Could not save the time. Check the console for details.")}finally{c.disabled=!1,c.textContent="Save changes"}}else alert("Error: No prayer selected to update.")},y=async()=>{const t=document.getElementById("announcementTitle"),n=document.getElementById("announcementMessage"),o=document.getElementById("postAnnouncementBtn"),c=t.value.trim(),m=n.value.trim();if(c&&m){o.disabled=!0,o.textContent="Posting...",console.log("Attempting to post a new announcement...");try{const i=a(e,`${d}/announcements`);await s(i,{title:c,message:m,timestamp:l()}),console.log("Announcement posted successfully."),r&&r.hide(),t.value="",n.value=""}catch(e){console.error("Failed to post announcement:",e),alert("Error: Could not post the announcement. Check the console for details.")}finally{o.disabled=!1,o.textContent="Post Announcement"}}else alert("Please fill out both the title and the message.")};document.addEventListener("DOMContentLoaded",(()=>{console.log("Admin DOM loaded. Initializing admin scripts.");const o=document.getElementById("editTimeModal");o&&(m=new bootstrap.Modal(o));const a=document.getElementById("announcementModal");a&&(r=new bootstrap.Modal(a)),document.getElementById("saveTimeButton")?.addEventListener("click",g),document.getElementById("postAnnouncementBtn")?.addEventListener("click",y),document.querySelectorAll(".editable-time").forEach((e=>e.addEventListener("click",p))),(()=>{const e=document.getElementById("hourSelect"),t=document.getElementById("minuteSelect");if(e&&t){for(let t=0;t<24;t++){const n=String(t).padStart(2,"0");e.add(new Option(n,n))}["00","05","10","15","20","25","30","35","40","45","50","55"].forEach((e=>{t.add(new Option(e,e))}))}})(),(async()=>{})(),(()=>{const o=t(e,`${d}/prayerTimes/today`);n(o,(e=>{const t=e.exists()?e.data():{};console.log("Admin panel received prayer time update:",t),document.getElementById("p-fajr").textContent=t.Fajr||"00:00",document.getElementById("p-zuhr").textContent=t.Zuhr||"00:00",document.getElementById("p-asr").textContent=t.Asr||"00:00",document.getElementById("p-isha").textContent=t.Isha||"00:00",document.getElementById("p-jummah").textContent=t.Jumma||"00:00",document.getElementById("p-jummah-2").textContent=t.Jumma2||"00:00"}),(e=>console.error("Error listening to prayer times on admin page:",e)))})(),(async()=>{})()}));