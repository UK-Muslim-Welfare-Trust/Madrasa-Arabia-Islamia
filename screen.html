<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masjid Prayer Timetable</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">

    <!-- Note: Bootstrap is not used in this version to allow for a more custom, sleek design -->

    <style>
        :root {
            --bg-color: #0d1117;
            --card-color: #161b22;
            --border-color: #30363d;
            --text-color: #c9d1d9;
            --secondary-text-color: #8b949e;
            --primary-color: #238636;
            --primary-glow: rgba(35, 134, 54, 0.5);
            --highlight-bg: #2ea043;
            --highlight-text: #ffffff;
            --clock-hand-color: var(--text-color);
            --clock-second-hand-color: #e8534f;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 var(--primary-glow); }
            70% { box-shadow: 0 0 0 10px rgba(35, 134, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(35, 134, 54, 0); }
        }

        /* --- Navbar --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease-out;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .masjid-logo {
            width: 40px;
            height: 40px;
        }

        .masjid-name {
            font-size: 1.8vw;
            font-weight: 600;
        }
        
        .navbar-info {
            text-align: right;
        }

        #digital-clock {
            font-family: 'Teko', sans-serif;
            font-size: 2.5vw;
            font-weight: 600;
            line-height: 1;
        }

        #gregorian-date, #hijri-date {
            font-size: 1vw;
            color: var(--secondary-text-color);
        }
        
        /* --- Main Content --- */
        .main-container {
            display: flex;
            flex-grow: 1;
            padding: 2rem;
            gap: 2rem;
            overflow: hidden;
        }

        .left-panel {
            flex: 4;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            animation: fadeIn 0.8s ease-out 0.2s backwards;
        }

        .right-panel {
            flex: 5;
            display: flex;
            flex-direction: column;
            animation: fadeIn 1s ease-out 0.4s backwards;
        }
        
        /* --- Analog Clock --- */
        .analog-clock {
            width: 30vw;
            height: 30vw;
            background-color: var(--card-color);
            border-radius: 50%;
            border: 5px solid var(--border-color);
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,0,0,0.4);
        }

        .clock-face {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom;
            border-radius: 50px;
        }

        .hour-hand {
            width: 6px;
            height: 25%;
            background-color: var(--clock-hand-color);
            z-index: 3;
        }
        .min-hand {
            width: 4px;
            height: 35%;
            background-color: var(--clock-hand-color);
            z-index: 4;
        }
        .sec-hand {
            width: 2px;
            height: 40%;
            background-color: var(--clock-second-hand-color);
            z-index: 5;
        }

        .clock-center {
            width: 15px;
            height: 15px;
            background-color: var(--clock-second-hand-color);
            border: 3px solid var(--bg-color);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 6;
        }

        .clock-marker {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            font-family: 'Teko', sans-serif;
            font-size: 2vw;
        }

        .clock-marker:nth-child(1) { transform: rotate(30deg); }
        .clock-marker:nth-child(2) { transform: rotate(60deg); }
        .clock-marker:nth-child(3) { transform: rotate(90deg); }
        .clock-marker:nth-child(4) { transform: rotate(120deg); }
        .clock-marker:nth-child(5) { transform: rotate(150deg); }
        .clock-marker:nth-child(6) { transform: rotate(180deg); }
        .clock-marker:nth-child(7) { transform: rotate(210deg); }
        .clock-marker:nth-child(8) { transform: rotate(240deg); }
        .clock-marker:nth-child(9) { transform: rotate(270deg); }
        .clock-marker:nth-child(10){ transform: rotate(300deg); }
        .clock-marker:nth-child(11){ transform: rotate(330deg); }
        .clock-marker span {
            display: inline-block;
            transform: translateY(-13.5vw) rotate(calc(-1 * var(--i, 0) * 30deg));
        }


        /* --- Info Cards --- */
        .info-cards {
            display: flex;
            justify-content: center;
            gap: 2rem;
            width: 100%;
        }

        .info-card {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            text-align: center;
            flex-grow: 1;
        }

        .info-card .label {
            font-size: 1.2vw;
            color: var(--secondary-text-color);
        }

        .info-card .value {
            font-family: 'Teko', sans-serif;
            font-size: 2.5vw;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* --- Prayer List --- */
        .prayer-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: 100%;
        }

        .prayer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            transition: all 0.3s ease;
        }
        
        .prayer-item.highlight {
            background-color: var(--highlight-bg);
            color: var(--highlight-text);
            border-color: var(--primary-color);
            transform: scale(1.03);
            animation: pulse 2s infinite;
        }

        .prayer-name {
            font-size: 2vw;
            font-weight: 700;
            flex-basis: 30%;
        }

        .prayer-times {
            display: flex;
            gap: 2.5rem;
            font-family: 'Teko', sans-serif;
            font-size: 2.2vw;
            font-weight: 600;
            text-align: center;
        }
        .prayer-times > div {
            flex-basis: 120px;
        }
        
        .prayer-times .label {
            display: block;
            font-size: 1vw;
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            color: var(--secondary-text-color);
        }

        .prayer-item.highlight .prayer-times .label {
            color: rgba(255, 255, 255, 0.7);
        }

        .jummah-second {
            font-size: 1.2vw;
            font-weight: 400;
            color: var(--secondary-text-color);
            display: block;
            margin-top: -5px;
        }
        
        .prayer-item.highlight .jummah-second {
             color: rgba(255, 255, 255, 0.7);
        }

        /* --- Footer --- */
        .donation-bar {
            background-color: var(--card-color);
            border-top: 1px solid var(--border-color);
            text-align: center;
            padding: 0.75rem;
            font-size: 1.1vw;
            font-weight: 500;
        }
        
        /* --- Overlay --- */
        #phone-off-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s;
        }
        
        #phone-off-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .overlay-icon { width: 10vw; height: 10vw; margin-bottom: 2rem; }
        .overlay-text { font-size: 4vw; font-weight: 700; text-align: center; color: #fff; }
        .overlay-subtext { font-size: 2vw; margin-top: 1rem; color: var(--secondary-text-color); }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <svg class="masjid-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--primary-color)">
                <path d="M12.74,2.34a1,1,0,0,0-1.48,0l-9,9A1,1,0,0,0,3,13.25V21a1,1,0,0,0,1,1H20a1,1,0,0,0,1-1V13.25a1,1,0,0,0-.26-1.91ZM20,20H16V15a4,4,0,0,0-8,0v5H4V13.41l8-8,8,8Z"></path>
            </svg>
            <span class="masjid-name">Wakefield Central Mosque</span>
        </div>
        <div class="navbar-info">
            <div id="digital-clock">--:--:--</div>
            <div id="gregorian-date">---</div>
            <div id="hijri-date">---</div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <div class="left-panel">
            <div class="analog-clock">
                <div class="clock-face">
                    <div class="clock-marker"><span>1</span></div>
                    <div class="clock-marker"><span>2</span></div>
                    <div class="clock-marker"><span>3</span></div>
                    <div class="clock-marker"><span>4</span></div>
                    <div class="clock-marker"><span>5</span></div>
                    <div class="clock-marker"><span>6</span></div>
                    <div class="clock-marker"><span>7</span></div>
                    <div class="clock-marker"><span>8</span></div>
                    <div class="clock-marker"><span>9</span></div>
                    <div class="clock-marker"><span>10</span></div>
                    <div class="clock-marker"><span>11</span></div>
                    <div class="clock-marker"><span>12</span></div>

                    <div class="clock-hand hour-hand" id="hour-hand"></div>
                    <div class="clock-hand min-hand" id="min-hand"></div>
                    <div class="clock-hand sec-hand" id="sec-hand"></div>
                    <div class="clock-center"></div>
                </div>
            </div>
            <div class="info-cards">
                <div class="info-card">
                    <div class="label">Sunrise</div>
                    <div class="value" id="sunrise-time">--:--</div>
                </div>
                <div class="info-card">
                    <div class="label">Zawwal</div>
                    <div class="value" id="zawwal-time">--:--</div>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div id="prayer-list" class="prayer-list">
                <!-- Prayer items injected by JS -->
            </div>
        </div>
    </main>

    <!-- Donation Bar -->
    <footer class="donation-bar">
        Please donate generously to support your Masjid's activities.
    </footer>
    
    <!-- Phone Off Overlay -->
    <div id="phone-off-overlay">
        <svg class="overlay-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="white">
            <path d="M344 0H168c-17.7 0-32 14.3-32 32v448c0 17.7 14.3 32 32 32h176c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32zM256 480a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm96-128H160V64h192v288z"/>
            <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L434.7 256 329.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM9.4 278.6c-12.5-12.5-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3L77.3 256l105.4 105.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0l-128-128z"/>
        </svg>
        <div class="overlay-text">Please switch off your phone</div>
        <div id="overlay-clock" class="overlay-subtext"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { apiKey: "AIza...", authDomain: "...", projectId: "..." }; // Fallback config
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'masjid-connect-app';

        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- Firebase Initialization ---
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const elements = {
            digitalClock: document.getElementById('digital-clock'),
            gregorianDate: document.getElementById('gregorian-date'),
            hijriDate: document.getElementById('hijri-date'),
            hourHand: document.getElementById('hour-hand'),
            minHand: document.getElementById('min-hand'),
            secHand: document.getElementById('sec-hand'),
            prayerList: document.getElementById('prayer-list'),
            sunriseTime: document.getElementById('sunrise-time'),
            zawwalTime: document.getElementById('zawwal-time'),
            phoneOffOverlay: document.getElementById('phone-off-overlay'),
            overlayClock: document.getElementById('overlay-clock'),
        };
        
        // --- State Variables ---
        let prayerTimesData = {};
        let jamaatTimesData = {};

        // --- Utility Functions ---
        const formatTime12h = (timeStr) => {
            if (!timeStr || !timeStr.includes(':')) return '--:--';
            const [hours, minutes] = timeStr.split(':');
            let h = parseInt(hours, 10);
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${String(h).padStart(2, '0')}:${minutes} ${ampm}`;
        };

        const timeToMinutes = (timeStr) => {
            if (!timeStr || !timeStr.includes(':')) return null;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        };
        
        const minutesToTime24h = (minutes) => {
            if (minutes === null || isNaN(minutes)) return null;
            const h = Math.floor(minutes / 60) % 24;
            const m = minutes % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        };

        // --- Data Fetching ---
        const fetchHijriDate = async () => {
             try {
                const today = new Date();
                const d = String(today.getDate()).padStart(2, '0');
                const m = String(today.getMonth() + 1).padStart(2, '0');
                const y = today.getFullYear();
                const response = await fetch(`https://api.aladhan.com/v1/gToH?date=${d}-${m}-${y}`);
                if (!response.ok) throw new Error('Network response failed');
                const data = await response.json();
                if (data.code === 200 && data.data.hijri) {
                    const hijri = data.data.hijri;
                    elements.hijriDate.textContent = `${hijri.day} ${hijri.month.en} ${hijri.year}H`;
                }
            } catch (error) {
                console.error("Could not fetch Hijri date:", error);
                elements.hijriDate.textContent = 'Could not load Hijri date';
            }
        };
        
        const setupPrayerTimeListeners = () => {
            const firestorePath = `artifacts/${appId}/public/data`;
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const calendarDocId = `${day}-${month}`;

            onSnapshot(doc(db, `${firestorePath}/prayerTimes/today`), (doc) => {
                if (doc.exists()) {
                    jamaatTimesData = doc.data();
                    updateUI();
                }
            });

            onSnapshot(doc(db, `${firestorePath}/prayerCalendar/${calendarDocId}`), (doc) => {
                if (doc.exists()) {
                    prayerTimesData = doc.data();
                    updateUI();
                }
            });
        };
        
        // --- UI Update Logic ---
        const updateUI = () => {
            if (!prayerTimesData.Fajr || !jamaatTimesData.Fajr) return;

            elements.prayerList.innerHTML = '';
            const isFriday = new Date().getDay() === 5;
            const prayerOrder = ['Fajr', isFriday ? 'Jummah' : 'Zuhr', 'Asr', 'Maghrib', 'Isha'];

            prayerOrder.forEach(prayer => {
                const prayerKey = (prayer === 'Jummah') ? 'Zuhr' : prayer;
                const start = formatTime12h(prayerTimesData[prayerKey]);
                const jamaat = formatTime12h(jamaatTimesData[prayer]);
                
                const item = document.createElement('div');
                item.className = 'prayer-item';
                item.id = `item-${prayer.toLowerCase()}`;
                
                let jamaatHtml = `<div><span class="label">Jama'at</span>${jamaat}</div>`;
                if (prayer === 'Jummah') {
                    const jamaat2 = formatTime12h(jamaatTimesData.Jumma2);
                    jamaatHtml = `<div><span class="label">Jama'at</span>${jamaat} <span class="jummah-second">2nd: ${jamaat2}</span></div>`;
                }

                item.innerHTML = `
                    <div class="prayer-name">${prayer}</div>
                    <div class="prayer-times">
                        <div><span class="label">Start</span>${start}</div>
                        ${jamaatHtml}
                    </div>
                `;
                elements.prayerList.appendChild(item);
            });

            elements.sunriseTime.textContent = formatTime12h(prayerTimesData.Sunrise);
            const zuhrStartMinutes = timeToMinutes(prayerTimesData.Zuhr);
            elements.zawwalTime.textContent = formatTime12h(minutesToTime24h(zuhrStartMinutes - 10));
        };
        
        const highlightCurrentPrayer = () => {
            const now = new Date();
            const nowMinutes = now.getHours() * 60 + now.getMinutes();
            const isFriday = now.getDay() === 5;
            
            const prayerOrder = ['Fajr', isFriday ? 'Jummah' : 'Zuhr', 'Asr', 'Maghrib', 'Isha'];
            const times = prayerOrder.map(p => ({ 
                name: p, 
                start: timeToMinutes(prayerTimesData[(p === 'Jummah' ? 'Zuhr' : p)]) 
            })).filter(p => p.start !== null);
            
            times.sort((a, b) => a.start - b.start);

            let currentPrayer = '';
            if (nowMinutes >= times[times.length - 1].start || nowMinutes < times[0].start) {
                currentPrayer = times[times.length - 1].name;
            } else {
                 for (let i = 0; i < times.length - 1; i++) {
                    if (nowMinutes >= times[i].start && nowMinutes < times[i + 1].start) {
                        currentPrayer = times[i].name;
                        break;
                    }
                }
            }

            document.querySelectorAll('.prayer-item').forEach(row => row.classList.remove('highlight'));
            if (currentPrayer) {
                const currentItem = document.getElementById(`item-${currentPrayer.toLowerCase()}`);
                if (currentItem) currentItem.classList.add('highlight');
            }
        };

        const checkPhoneOffMessage = () => {
            const now = new Date();
            const nowMinutes = now.getHours() * 60 + now.getMinutes();
            let showOverlay = false;
            
            const jamaatTimes = [
                jamaatTimesData.Fajr, jamaatTimesData.Zuhr, jamaatTimesData.Asr, 
                jamaatTimesData.Maghrib, jamaatTimesData.Isha,
                jamaatTimesData.Jumma, jamaatTimesData.Jumma2
            ].map(timeToMinutes).filter(t => t !== null);

            for (const jamaat of jamaatTimes) {
                if (nowMinutes >= jamaat - 1 && nowMinutes <= jamaat + 5) {
                    showOverlay = true;
                    break;
                }
            }
            elements.phoneOffOverlay.classList.toggle('visible', showOverlay);
        };

        // --- Clock Update Logic ---
        const updateClocks = () => {
            const now = new Date();
            // Digital
            elements.digitalClock.textContent = now.toLocaleTimeString('en-US', { hour12: false });
            elements.overlayClock.textContent = now.toLocaleTimeString('en-GB');
            
            // Analog
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours();

            const secDeg = (seconds / 60) * 360;
            const minDeg = (minutes / 60) * 360 + (seconds / 60) * 6;
            const hourDeg = (hours / 12) * 360 + (minutes / 60) * 30;

            elements.secHand.style.transform = `translateX(-50%) rotate(${secDeg}deg)`;
            elements.minHand.style.transform = `translateX(-50%) rotate(${minDeg}deg)`;
            elements.hourHand.style.transform = `translateX(-50%) rotate(${hourDeg}deg)`;
        };


        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            elements.gregorianDate.textContent = new Date().toLocaleDateString('en-GB', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            fetchHijriDate();
            setupPrayerTimeListeners();
            
            setInterval(() => {
                updateClocks();
                if (Object.keys(prayerTimesData).length > 0) {
                     highlightCurrentPrayer();
                     checkPhoneOffMessage();
                }
            }, 1000);
        });
    </script>
</body>
</html>


